<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>WebSocket Client</title>
<script>
document.addEventListener('DOMContentLoaded', function() {

    // Parameter auslesen und an den Server schicken
    let params = new URLSearchParams(window.location.search);
    let id = params.get('id');

    // Websocket erstellen
    const ws = new WebSocket('ws://localhost:8080?id='+id);
    ws.binaryType = 'arraybuffer';

    ws.onopen = function() {
        console.log('Verbindung zum Server hergestellt.');
    };

    ws.onerror = function(error) {
        console.log('WebSocket-Fehler: ' + error);
    };

    ws.onmessage = function(e) {

        let message = e.data;
        if ( e.data instanceof ArrayBuffer ){
            message = new TextDecoder().decode(e.data);
        }
        message = JSON.parse(message);
        //const message = JSON.parse(e.data instanceof ArrayBuffer ? new TextDecoder().decode(e.data) : e.data);

        console.log('Nachricht erhalten:', message);
        document.getElementById('messages').innerHTML += `<li>${message.sender}: ${message.text}</li>`;
    };

    document.getElementById('sendButton').onclick = function() {
        const message = {
            sender: document.getElementById('name').value,
            text: document.getElementById('message').value
        };
        ws.send(JSON.stringify(message));
    };

    const screenWidth = window.innerWidth;
    const screenHeight = window.innerHeight;
});
</script>
</head>
<body>
  <h1>WebSocket Chat</h1>

  <input type="text" id="name" placeholder="Dein Name">
  <input type="text" id="message" placeholder="Deine Nachricht">
  <button id="sendButton">Senden</button>
  <ul id="messages"></ul>
</body>
</html>
